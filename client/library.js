(function(exports) {
    "use strict";

    var LIBRARY =
{"album": [[1, [0, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]], [23, [6]]], "artist": [[0, [0, 9, 10, 11, 12, 13, 14, 17, 19, 21, 22]], [6, [1, 2]], [11, [3]], [15, [4]], [19, [5]], [22, [6]], [27, [7]], [30, [8, 15, 16, 18, 20]], [77, [23]]], "path": [[4, [0, 1, 2, 3, 4, 5, 6, 7]], [33, [8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]]], "root": "W:\\Music\\Dumb Garbage from Anime\\Vocaloid", "pool": ["40mP feat. \u521d\u97f3\u30df\u30af", "\u5c11\u5e74\u3068\u9b54\u6cd5\u306e\u30ed\u30dc\u30c3\u30c8", "\u304b\u3089\u304f\u308a\u30d4\u30a8\u30ed (off vocal)", "2013", "", "40mP feat. \u521d\u97f3\u30df\u30af. \u304b\u3089\u304f\u308a\u30d4\u30a8\u30ed (off vocal).mp3", "40mP feat. \u6625\u30dd\u30b1 and NicoNico Chorus", "\u304b\u3089\u304f\u308a\u30d4\u30a8\u30ed (Chorus Version) (Clean Intro)", "Karakuri Pierrot (Chorus) (Clean Intro).mp3", "\u304b\u3089\u304f\u308a\u30d4\u30a8\u30ed (Chorus Version)", "Karakuri Pierrot (Chorus).mp3", "40mP feat. Ashe", "\u304b\u3089\u304f\u308a\u30d4\u30a8\u30ed (English)", "2011-25-07", "Karakuri Pierrot [Ashe].mp3", "Mitchie M feat. \u521d\u97f3\u30df\u30af", "Burenai ai de", "2014", "Mitchie M feat. \u521d\u97f3\u30df\u30af. Burenai ai de.mp3", "Mitchie M", "Burenai ai de (off vocal)", "Mitchie M. Burenai ai de (off vocal).mp3", "\u3046\u305f\u305fP feat.MAYU", "EXIT TUNES PRESENTS Vocalofanatic feat.GUMI\u3001IA\u3001MAYU", "\u4e03\u8ee2\u3073\u516b\u8d77\u304d\u306a\u3044", "1/1", "\u3046\u305f\u305fP feat.MAYU. \u4e03\u8ee2\u3073\u516b\u8d77\u304d\u306a\u3044.mp3", "\u3046\u305f\u305fP", "\u4e03\u8ee2\u3073\u516b\u8d77\u304d\u306a\u3044 (off vocal)", "\u3046\u305f\u305fP. \u4e03\u8ee2\u3073\u516b\u8d77\u304d\u306a\u3044 (off vocal).mp3", "40mP feat. GUMI", "\u5c11\u5e74\u3068\u9b54\u6cd5\u306e\u30ed\u30dc\u30c3\u30c8\uff08Album Edit Ver.\uff09", "1/16", "40mP - Shounen to Mahou no Robot VOCALOID BEST,NEW RECORDINGS", "01.\u5c11\u5e74\u3068\u9b54\u6cd5\u306e\u30ed\u30dc\u30c3\u30c8\uff08Album Edit Ver.\uff09.mp3", "Melody in the sky", "2/16", "02.Melody in the sky.mp3", "Step to you", "3/16", "03.Step to you.mp3", "\u5de8\u5927\u5c11\u5973 ", "4/16", "04.\u5de8\u5927\u5c11\u5973.mp3", "\u30b8\u30a7\u30f3\u30ac", "5/16", "05.\u30b8\u30a7\u30f3\u30ac.mp3", "\u30c8\u30ea\u30ce\u30b3\u30b7\u30c6\u30a3", "6/16", "06.\u30c8\u30ea\u30ce\u30b3\u30b7\u30c6\u30a3.mp3", "\u5984\u60f3\u30b9\u30b1\u30c3\u30c1", "7/16", "07.\u5984\u60f3\u30b9\u30b1\u30c3\u30c1.mp3", "\u30ad\u30ea\u30c8\u30ea\u30bb\u30f3", "8/16", "08.\u30ad\u30ea\u30c8\u30ea\u30bb\u30f3.mp3", "\u5922\u5730\u56f3", "9/16", "09.\u5922\u5730\u56f3.mp3", "\u304b\u3089\u304f\u308a\u30d4\u30a8\u30ed", "10/16", "10.\u304b\u3089\u304f\u308a\u30d4\u30a8\u30ed.mp3", "\u30b7\u30ea\u30e7\u30af\u30b1\u30f3\u30b5", "11/16", "11.\u30b7\u30ea\u30e7\u30af\u30b1\u30f3\u30b5.mp3", "\u30c9\u30ec\u30df\u30d5\u30a1\u30ed\u30f3\u30c9", "12/16", "12.\u30c9\u30ec\u30df\u30d5\u30a1\u30ed\u30f3\u30c9.mp3", "\u6625\u306b\u4e00\u756a\u8fd1\u3044\u8857", "13/16", "13.\u6625\u306b\u4e00\u756a\u8fd1\u3044\u8857.mp3", "\u6771\u4eac\u306e\u771f\u30f3\u4e2d\u3067\u5bdd\u8ee2\u3076", "14/16", "14.\u6771\u4eac\u306e\u771f\u30f3\u4e2d\u3067\u5bdd\u8ee2\u3076.mp3", "\u5343\u5e74\u6a4b\u3068\u5f71\u6cd5\u5e2b", "15/16", "15.\u5343\u5e74\u6a4b\u3068\u5f71\u6cd5\u5e2b.mp3", "40mP feat. \u521d\u97f3\u30df\u30af\u30fbGUMI", "\u30b3\u30c8\u30d0\u306e\u3046\u305f", "16/16", "16.\u30b3\u30c8\u30d0\u306e\u3046\u305f.mp3"], "songs": [{"album": [1], "title": [2], "contexts": {"album": [[0, 0]], "path": [[0, 0]], "artist": [[0, 0]]}, "artist": [0], "filename": 5, "path": 4, "date": [3], "tracknumber": []}, {"album": [], "title": [7], "contexts": {"album": [], "path": [[0, 1]], "artist": [[1, 0]]}, "artist": [6], "filename": 8, "path": 4, "date": [], "tracknumber": []}, {"album": [], "title": [9], "contexts": {"album": [], "path": [[0, 2]], "artist": [[1, 1]]}, "artist": [6], "filename": 10, "path": 4, "date": [], "tracknumber": []}, {"album": [], "title": [12], "contexts": {"album": [], "path": [[0, 3]], "artist": [[2, 0]]}, "artist": [11], "filename": 14, "path": 4, "date": [13], "tracknumber": []}, {"album": [], "title": [16], "contexts": {"album": [], "path": [[0, 4]], "artist": [[3, 0]]}, "artist": [15], "filename": 18, "path": 4, "date": [17], "tracknumber": []}, {"album": [], "title": [20], "contexts": {"album": [], "path": [[0, 5]], "artist": [[4, 0]]}, "artist": [19], "filename": 21, "path": 4, "date": [], "tracknumber": []}, {"album": [23], "title": [24], "contexts": {"album": [[1, 0]], "path": [[0, 6]], "artist": [[5, 0]]}, "artist": [22], "filename": 26, "path": 4, "date": [17], "tracknumber": [25]}, {"album": [], "title": [28], "contexts": {"album": [], "path": [[0, 7]], "artist": [[6, 0]]}, "artist": [27], "filename": 29, "path": 4, "date": [3], "tracknumber": []}, {"album": [1], "title": [31], "contexts": {"album": [[0, 1]], "path": [[1, 0]], "artist": [[7, 0]]}, "artist": [30], "filename": 34, "path": 33, "date": [3], "tracknumber": [32]}, {"album": [1], "title": [35], "contexts": {"album": [[0, 2]], "path": [[1, 1]], "artist": [[0, 1]]}, "artist": [0], "filename": 37, "path": 33, "date": [3], "tracknumber": [36]}, {"album": [1], "title": [38], "contexts": {"album": [[0, 3]], "path": [[1, 2]], "artist": [[0, 2]]}, "artist": [0], "filename": 40, "path": 33, "date": [3], "tracknumber": [39]}, {"album": [1], "title": [41], "contexts": {"album": [[0, 4]], "path": [[1, 3]], "artist": [[0, 3]]}, "artist": [0], "filename": 43, "path": 33, "date": [3], "tracknumber": [42]}, {"album": [1], "title": [44], "contexts": {"album": [[0, 5]], "path": [[1, 4]], "artist": [[0, 4]]}, "artist": [0], "filename": 46, "path": 33, "date": [3], "tracknumber": [45]}, {"album": [1], "title": [47], "contexts": {"album": [[0, 6]], "path": [[1, 5]], "artist": [[0, 5]]}, "artist": [0], "filename": 49, "path": 33, "date": [3], "tracknumber": [48]}, {"album": [1], "title": [50], "contexts": {"album": [[0, 7]], "path": [[1, 6]], "artist": [[0, 6]]}, "artist": [0], "filename": 52, "path": 33, "date": [3], "tracknumber": [51]}, {"album": [1], "title": [53], "contexts": {"album": [[0, 8]], "path": [[1, 7]], "artist": [[7, 1]]}, "artist": [30], "filename": 55, "path": 33, "date": [3], "tracknumber": [54]}, {"album": [1], "title": [56], "contexts": {"album": [[0, 9]], "path": [[1, 8]], "artist": [[7, 2]]}, "artist": [30], "filename": 58, "path": 33, "date": [3], "tracknumber": [57]}, {"album": [1], "title": [59], "contexts": {"album": [[0, 10]], "path": [[1, 9]], "artist": [[0, 7]]}, "artist": [0], "filename": 61, "path": 33, "date": [3], "tracknumber": [60]}, {"album": [1], "title": [62], "contexts": {"album": [[0, 11]], "path": [[1, 10]], "artist": [[7, 3]]}, "artist": [30], "filename": 64, "path": 33, "date": [3], "tracknumber": [63]}, {"album": [1], "title": [65], "contexts": {"album": [[0, 12]], "path": [[1, 11]], "artist": [[0, 8]]}, "artist": [0], "filename": 67, "path": 33, "date": [3], "tracknumber": [66]}, {"album": [1], "title": [68], "contexts": {"album": [[0, 13]], "path": [[1, 12]], "artist": [[7, 4]]}, "artist": [30], "filename": 70, "path": 33, "date": [3], "tracknumber": [69]}, {"album": [1], "title": [71], "contexts": {"album": [[0, 14]], "path": [[1, 13]], "artist": [[0, 9]]}, "artist": [0], "filename": 73, "path": 33, "date": [3], "tracknumber": [72]}, {"album": [1], "title": [74], "contexts": {"album": [[0, 15]], "path": [[1, 14]], "artist": [[0, 10]]}, "artist": [0], "filename": 76, "path": 33, "date": [3], "tracknumber": [75]}, {"album": [1], "title": [78], "contexts": {"album": [[0, 16]], "path": [[1, 15]], "artist": [[8, 0]]}, "artist": [77], "filename": 80, "path": 33, "date": [3], "tracknumber": [79]}]}
;

    function range(start, end) {
        var L = [];
        for (var i = start; i < end; i++)
            L.push(i);
        return L;
    }

    function Library(libraryData) {
        this.$data = libraryData;

        this._contexts = [
            new MetadataContext("artist"),
            new MetadataContext("album"),
            new SongsContext(),
            new SingleContext(),
        ];
        this._contexts.forEach(function(c) { c.$library = this }.bind(this));
    }
    Library.prototype.getSong = function(songID) {
        return this.$data.songs[songID];
    };
    Library.prototype.getString = function(cpoolID) {
        return this.$data.pool[cpoolID];
    };
    Library.prototype.getValidContexts = function(songID) {
        return this._contexts.filter(function(c) {
            return c.isValid(songID);
        });
    };

    // Returns N items around i inside L. The returned
    // list is always of size N*2+1, with the middle item
    // being the item at i. If there aren't enough items,
    // missing items are padded with undefined.
    function listContext(L, i, N) {
        var contextL = [];
        for (var x = i - N; x <= i + N; x++)
            contextL[x - i + N] = L[x];
        return contextL;
    }

    function Context() {}
    Context.prototype.isValid = function(songID) {
        return true;
    };
    Context.prototype.prev = function(songID) {
        var g = this.get(songID);
        var currIdx = g[0], L = g[1];
        return L[currIdx - 1];
    };
    Context.prototype.next = function(songID) {
        var g = this.get(songID);
        var currIdx = g[0], L = g[1];
        return L[currIdx + 1];
    };

    function MetadataContext(contextKey) { this.$contextKey = contextKey; this.title = contextKey; }
    MetadataContext.prototype = Object.create(Context.prototype);
    MetadataContext.prototype.isValid = function(songID) {
        var contextIDs = this.$library.$data.songs[songID].contexts[this.$contextKey];
        return contextIDs.length > 0;
    };
    MetadataContext.prototype.get = function(songID) {
        var contextIDs = this.$library.$data.songs[songID].contexts[this.$contextKey];
        var contextPair = contextIDs[0];
        var contextId = contextPair[0];
        var contextIdx = contextPair[1];
        var L = this.$library.$data[this.$contextKey][contextId][1];
        return [contextIdx, L];
    };

    function SongsContext() {}
    SongsContext.prototype = Object.create(Context.prototype);
    SongsContext.prototype.title = "songs";
    SongsContext.prototype.get = function(songID, start, length) {
        return [songID, this.$library.$data.songs];
    };

    function SingleContext() {}
    SingleContext.prototype = Object.create(Context.prototype);
    SingleContext.prototype.title = "single";
    SingleContext.prototype.get = function(songID, start, length) {
        return [0, [songID]];
    };

    window.$library = new Library(LIBRARY);

})(window);
